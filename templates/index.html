<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop - Inventory</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <style>
      body {
        display: flex;
        min-height: 100vh;
        overflow-x: hidden;
      }
      #sidebar {
        min-width: 250px;
        max-width: 250px;
        background: #212529;
        color: rgb(20, 18, 18);
        transition: all 0.3s;
      }
      #sidebar .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 15px 20px;
        border-bottom: 1px solid #343a40;
      }
      #sidebar .nav-link:hover {
        background: #343a40;
        color: white;
      }
      #sidebar .nav-link.active {
        background: #0d6efd;
        color: white;
      }
      #content {
        width: 100%;
      }
      .item-card {
        border-radius: 12px;
        transition: 0.3s;
        border: 1px solid #eee;
      }
      .item-card:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .item-img {
        height: 160px;
        object-fit: cover;
        border-radius: 12px 12px 0 0;
      }
    </style>
  </head>
  <body>
    <nav id="sidebar" class="d-none d-md-block">
      <div class="p-4"><h4 class="fw-bold text-primary">MY STORE</h4></div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a href="{{ url_for('index') }}" class="nav-link active">
            <i class="bi bi-house-door me-2"></i> Home
          </a>
        </li>
        <li class="nav-item">
          <a href="/viewproduct" class="nav-link"
            ><i class="bi bi-box-seam me-2"></i> View Products</a
          >
        </li>
        <li class="nav-item">
          <a href="/billing" class="nav-link"
            ><i class="bi bi-receipt me-2"></i> Billing</a
          >
        </li>
     
        <li class="nav-item">
          <a href="/logout" class="nav-link text-danger mt-5"
            ><i class="bi bi-box-arrow-right me-2"></i> Sign Out</a
          >
        </li>
      </ul>
    </nav>

    <div id="content" class="bg-light">
    
        <div class="container-fluid">
          <nav
        class="navbar navbar-expand-lg  bg-dark shadow-sm sticky-top mt-4"
      >
          <form class="d-flex flex-grow-1 mx-2">
            <div class="input-group">
              <span class="input-group-text bg-light border-0"
                ><i class="bi bi-search"></i
              ></span>
              <input
                id="searchInput"
                class="form-control bg-success border-0"
                type="search"
                placeholder="Search products..."
                onkeyup="filterProducts()"
              />
            </div>
          </form>
          <div class="d-flex align-items-center">
            <a
              href="/cart"
              class="position-relative"
            >
              <i class="bi bi-cart text-success fs-3"></i>
              <span
                id="cart-count"
                class="position-absolute translate-middle text-dark badge rounded-pill bg-danger"
                style="font-size: 0.7rem"
                >0</span
              >
            </a>
          </div>
        </div>
      </nav>

      <div class="container my-5">
        <h3 class="mb-4 fw-bold text-secondary">Our Products</h3>
        <div class="row row-cols-2 row-cols-md-4 g-4">
          {% for product in products %}
          <div class="col">
            <div class="card h-100 item-card text-center">
              <img
                src="/static/uploads/{{ product.image }}"
                class="item-img"
                alt="{{ product.product_name }}"
              />
              <div class="card-body">
                <h6 class="fw-bold">{{ product.product_name }}</h6>
                <p class="text-muted small mb-1">Qty: {{ product.quantity }}</p>
                <h5 class="text-primary mb-3">â‚¹{{ product.price }}</h5>
                <button
                  class="btn btn-success w-100"
                  onclick="addToCart('{{ product.product_name }}', '{{ product.price }}', '{{ product.image }}')"
                >
                  Add to Cart
                </button>
                <a href="{{ url_for('review_page', pid=product.id) }}" class="btn btn-success m-3">
    FEEDBACK
</a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div
        id="cartToast"
        class="toast align-items-center text-white bg-success border-0"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="d-flex">
          <div class="toast-body">
            <i class="bi bi-check-circle-fill "></i>
            <span id="toast-msg">Product added to cart!</span>
          </div>
          <button
            type="button"
            class="btn-close btn-close-white me-2 m-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // 1. Add to Cart and Save to LocalStorage
      function addToCart(name, price, image) {
        let cart = JSON.parse(localStorage.getItem("myCart")) || [];

        let existingItem = cart.find((item) => item.name === name);
        if (existingItem) {
          existingItem.qty += 1;
        } else {
          
          cart.push({ name: name, price: price, img: image, qty: 1 });
        }

        localStorage.setItem("myCart", JSON.stringify(cart));
        updateBadge();
        showToast(name + " added to cart!");
      }

    
      function showToast(message) {
        document.getElementById("toast-msg").innerText = message;
        const toastEl = document.getElementById("cartToast");
        const toast = new bootstrap.Toast(toastEl);
        toast.show();
      }

      
      function updateBadge() {
        let cart = JSON.parse(localStorage.getItem("myCart")) || [];
        const badge = document.getElementById("cart-count");
        if (badge) {
          let totalItems = cart.reduce(
            (total, item) => total + (item.qty || 1),
            0,
          );
          badge.innerText = totalItems;
        }
      }

    
      function filterProducts() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let cards = document.querySelectorAll(".col");
        cards.forEach((card) => {
          let title = card.querySelector(".fw-bold")?.innerText.toLowerCase();
          if (title) {
            card.style.display = title.includes(input) ? "" : "none";
          }
        });
      }

      // Initialize badge on page load
      window.onload = updateBadge;
    </script>
  </body>
</html>