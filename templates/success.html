<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Success - My Store</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <style>
      .success-icon {
        font-size: 5rem;
        animation: scaleUp 0.5s ease-out;
      }
      @keyframes scaleUp {
        from {
          transform: scale(0);
        }
        to {
          transform: scale(1);
        }
      }
      .order-card {
        border-radius: 20px;
        border: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }
      .item-row {
        border-bottom: 1px dashed #dee2e6;
        padding: 10px 0;
      }
      .item-row:last-child {
        border-bottom: none;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-md-6 text-center">
          <div class="mb-4">
            <i class="bi bi-check-circle-fill text-success success-icon"></i>
            <h2 class="fw-bold mt-2">Order Successful!</h2>
            <p class="text-muted">Thank you for shopping with us.</p>
          </div>

          <div class="card order-card overflow-hidden mb-4 text-start">
            <div class="card-header bg-success text-white py-3 border-0">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-receipt me-2"></i>Order Summary
              </h5>
            </div>
            <div class="card-body p-4">
              <div class="row mb-3">
                <div class="col-6">
                  <small class="text-muted d-block text-uppercase small fw-bold"
                    >Order ID</small
                  >
                  <span class="fw-bold text-dark" id="s-order-id"
                    >#INV-0000</span
                  >
                </div>
                <div class="col-6 text-end">
                  <small class="text-muted d-block text-uppercase small fw-bold"
                    >Customer</small
                  >
                  <span class="fw-bold text-dark" id="s-name"
                    >Customer Name</span
                  >
                </div>
              </div>

              <h6
                class="fw-bold text-uppercase small text-muted border-bottom pb-2"
              >
                Purchased Items
              </h6>
              <div id="items-list-container"></div>

              <div class="mt-4 pt-3 border-top">
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <span class="text-muted fw-bold">Payment Method:</span>
                  <span
                    class="badge bg-info text-dark text-uppercase"
                    id="s-method"
                    >CASH</span
                  >
                </div>
                <div class="d-flex justify-content-between align-items-center">
                  <h4 class="fw-bold mb-0">Total Amount:</h4>
                  <h4 class="text-primary fw-bold mb-0" id="s-total">₹0.00</h4>
                </div>
              </div>
            </div>
          </div>

          <div class="d-grid gap-2 d-md-block">
            <a
              href="/index"
              class="btn btn-primary btn-lg px-4 me-md-2 rounded-pill shadow-sm"
            >
              <i class="bi bi-house-door me-2"></i>Back to Home
            </a>
            <button
              onclick="window.print()"
              class="btn btn-outline-secondary btn-lg px-4 rounded-pill shadow-sm"
            >
              <i class="bi bi-printer me-2"></i>Print
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      window.onload = function () {
        // 1. Data-vai sessionStorage-la irundhu edukkavum
        const data = JSON.parse(sessionStorage.getItem("lastOrder"));

        if (data && data.items) {
          document.getElementById("s-order-id").innerText = data.orderId;
          document.getElementById("s-name").innerText = data.name;
          document.getElementById("s-total").innerText = "₹" + data.total;

          const methodElement = document.getElementById("s-method");
          if (methodElement) {
            methodElement.innerText = data.method || "CASH";
          }

          const container = document.getElementById("items-list-container");
          container.innerHTML = "";

          data.items.forEach((item) => {
            let qty = item.qty || 1;
            let price = parseFloat(item.price) || 0;
            let subtotal = price * qty;

            container.innerHTML += `
              <div class="item-row">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <div class="fw-bold text-dark">${item.name}</div>
                    <small class="text-muted">Rate: ₹${price.toFixed(2)} | Qty: ${qty}</small>
                  </div>
                  <div class="text-end fw-bold">₹${subtotal.toFixed(2)}</div>
                </div>
              </div>`;
          });

          // 2. Display panna piragu cart-ai clear pannavum
          let user = "{{ session['user'] }}" || "guest";
          localStorage.removeItem("myCart_" + user);
        } else {
          document.getElementById("items-list-container").innerHTML =
            `<div class="alert alert-warning text-center">No recent order details found.</div>`;
        }
      };
    </script>
  </body>
</html>
