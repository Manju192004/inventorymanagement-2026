<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Feedback</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <style>
      body {
        background-color: #f4f7f6;
        margin: 0;
        padding: 0;
        display: flex; /* Sidebar and Content pakkom pakkom vara */
        height: 100vh;
        overflow: hidden;
      }

      /* Sidebar Style */
      #sidebar {
        width: 250px;
        background: white;
        height: 100vh;
        border-right: 1px solid #ddd;
        flex-shrink: 0; /* Sidebar size fixed-ah irukka */
      }

      #sidebar .nav-link {
        color: #333;
        padding: 12px 20px;
        transition: 0.3s;
      }

      #sidebar .nav-link:hover,
      #sidebar .nav-link.active {
        background: #e9ecef;
        color: #0d6efd;
      }

      /* Main Content Container */
      .main-content {
        flex-grow: 1; /* Meethi irukura space-ah content eduthukkum */
        display: flex;
        align-items: center; /* Vertical-ah center panna */
        justify-content: center; /* Horizontal-ah center panna */
        padding: 20px;
        overflow-y: auto;
      }

      .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 450px; /* Card size control panna */
      }

      .bg-custom {
        background: #198754;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="main-content">
      <div id="form-container" class="card p-4">
        <h2 class="text-center fw-bold mb-4">FEEDBACK</h2>
        <form id="reviewForm">
          <input
            type="hidden"
            name="product_id"
            value="{{ product_id if product_id else '' }}"
          />

          <div class="mb-3">
            <label class="form-label fw-semibold">Rating (1-5)</label>
            <select class="form-select" name="rating" id="ratinginput">
              <option value="5">5 - Excellent</option>
              <option value="4">4 - Good</option>
              <option value="3">3 - Average</option>
              <option value="2">2 - Poor</option>
              <option value="1">1 - Terrible</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Description</label>
            <textarea
              class="form-control"
              name="description"
              id="descinput"
              rows="4"
              placeholder="Your comments..."
              required
            ></textarea>
          </div>

          <button type="submit" class="btn btn-success w-100 py-2 fw-bold">
            SUBMIT FEEDBACK
          </button>
          <div class="text-center mt-3">
            <a href="/" class="text-muted text-decoration-none small"
              >Cancel and Return</a
            >
          </div>
        </form>
      </div>

      <div id="result-container" class="card p-4 d-none text-center">
        <div class="mb-3">
          <i
            class="bi bi-check-circle-fill text-success"
            style="font-size: 3rem"
          ></i>
        </div>
        <h3 class="text-success fw-bold">Thank You!</h3>
        <p class="text-muted">Your feedback has been recorded.</p>
        <div class="bg-light p-3 rounded text-start mb-3">
          <p class="mb-1">
            <strong>Rating:</strong> <span id="showrating"></span>/5
          </p>
          <p class="mb-0">
            <strong>Comment:</strong> <span id="descmsg"></span>
          </p>
        </div>
        <button
          class="btn btn-outline-success w-100 mb-2"
          onclick="location.reload()"
        >
          Edit Feedback
        </button>
        <a href="/index" class="btn btn-success w-100">Back to Home</a>
      </div>
    </div>

    <script>
      const form = document.getElementById("reviewForm");
      const formDiv = document.getElementById("form-container");
      const resultDiv = document.getElementById("result-container");

      form.onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(form);

        try {
          const response = await fetch("/save_feedback", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();

          if (data.status === "success") {
            document.getElementById("showrating").innerText =
              document.getElementById("ratinginput").value;
            document.getElementById("descmsg").innerText =
              document.getElementById("descinput").value;

            formDiv.classList.add("d-none");
            resultDiv.classList.remove("d-none");
          } else {
            alert("Submission failed: " + (data.message || "Unknown error"));
          }
        } catch (err) {
          console.error("Error:", err);
          alert("Could not connect to server.");
        }
      };
    </script>
  </body>
</html>
